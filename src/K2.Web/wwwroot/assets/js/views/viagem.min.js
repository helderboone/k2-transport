var Viagem=function(){var n=function(){$.get(App.corrigirPathRota("viagens-previstas"),function(n){$(".viagens-previstas").html(n);$("#bCadastrar").click(function(){t(null)});$("a[class*='excluir-viagem']").each(function(){var n=$(this).data("id");$(this).click(function(){App.exibirConfirm("Deseja realmente excluir essa viagem?","Sim","Não",function(){i(n,!0)})})});$("a[class*='listar-reservas']").each(function(){var n=$(this).data("id");$(this).click(function(){r(n)})})}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()})},r=function(n){App.exibirModalPorRota(App.corrigirPathRota("listar-por-viagem/"+n),function(){})},u=function(){App.bloquear();$("#tblViagem").DataTable({ajax:{url:App.corrigirPathRota("listar-viagens"),type:"POST",error:function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()},data:function(n){n.Nome=$("#iProcurarNome").val();n.Uf=$("#sProcurarEstado").val()}},info:!0,columns:[{data:"nome",title:"Nome",orderable:!0,className:"all"},{data:"uf",title:"Estado",orderable:!0},{data:null,className:"td-actions dt-center",orderable:!1,width:"70px",render:function(n,t,i){return'<a href="#" data-id="'+i.id+'" class="alterar-viagem m-portlet__nav-link btn m-btn m-btn--hover-brand m-btn--icon m-btn--icon-only m-btn--pill" data-container="body" data-toggle="m-tooltip" data-placement="left" title="" data-original-title="Alterar"><i class="la la-edit"><\/i><\/a><a href="#" data-id="'+i.id+'" class="excluir-viagem m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill" data-container="body" data-toggle="m-tooltip" data-placement="left" title="" data-original-title="Excluir"><i class="la la-trash"><\/i><\/a>'}}],select:{style:"single",info:!1},serverSide:!0,responsive:!0,pagingType:"full_numbers",order:[0,"asc"],searching:!1,paging:!0,lengthChange:!1,pageLength:25}).on("draw.dt",function(){mApp.initTooltips();$("a[class*='alterar-viagem']").each(function(){var n=$(this).data("id");$(this).click(function(){t(n)})});$("a[class*='excluir-viagem']").each(function(){var n=$(this).data("id");$(this).click(function(){App.exibirConfirm("Deseja realmente excluir essa viagem?","Sim","Não",function(){i(n)})})})}).on("processing.dt",function(){App.bloquear()})},f=function(){$("#frmProcurarViagem").validate({submitHandler:function(){$("#tblViagem").DataTable().ajax.reload()}})},t=function(t){var i=t===null||t===0;App.exibirModalPorRota(i?App.corrigirPathRota("cadastrar-viagem"):App.corrigirPathRota("alterar-viagem/"+t),function(){$("#sMotorista").select2({placeholder:"Selecione um motorista",dropdownParent:$(".jc-bs3-container")});$("#sCarro").select2({placeholder:"Selecione um carro",dropdownParent:$(".jc-bs3-container")});$("#sLocalidadeEmbarque").select2({placeholder:"Selecione a localidade de embarque",dropdownParent:$(".jc-bs3-container")});$("#sLocalidadeDesembarque").select2({placeholder:"Selecione a localidade de desembarque",dropdownParent:$(".jc-bs3-container")});var t=$("#iDataHorarioSaida").data("startdate");$("#iDataHorarioSaida").datetimepicker({todayHighlight:!1,autoclose:!0,pickerPosition:"bottom-left",format:"dd/mm/yyyy hh:ii",startDate:t,language:"pt-BR"});$("#iValorPassagem").inputmask("decimal",{radixPoint:",",groupSeparator:".",autoGroup:!0,digits:2,digitsOptional:!1,placeholder:"0",rightAlign:!1,prefix:"",onBeforeMask:function(n){return n}});$("#frmManterViagem").validate({rules:{iDescricao:{required:!0},iDataHorarioSaida:{required:!0},sMotorista:{required:!0},sCarro:{required:!0},sLocalidadeEmbarque:{required:!0},sLocalidadeDesembarque:{required:!0}},submitHandler:function(){var t={Id:$("#iIdViagem").val(),IdCarro:$("#sCarro").val(),IdMotorista:$("#sMotorista").val(),IdLocalidadeEmbarque:$("#sLocalidadeEmbarque").val(),IdLocalidadeDesembarque:$("#sLocalidadeDesembarque").val(),Descricao:$("#iDescricao").val(),ValorPassagem:$("#iValorPassagem").val(),DataHorarioSaida:$("#iDataHorarioSaida").val(),LocaisEmbarque:$("#tLocaisEmbarque").val().split("\n"),LocaisDesembarque:$("#tLocaisDesembarque").val().split("\n")};App.bloquear($("#frmManterViagem"));$.post(App.corrigirPathRota(i?"cadastrar-viagem":"alterar-viagem"),{entrada:t}).done(function(t){var i=Feedback.converter(t);i.Tipo.Nome==Tipo.Sucesso?i.exibirModal(function(){n();App.ocultarModal()}):i.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()}).always(function(){App.desbloquear($("#frmManterViagem"))})}})})},i=function(t,i){App.bloquear();$.post(App.corrigirPathRota("excluir-viagem/"+t),function(t){var r=Feedback.converter(t);r.Tipo.Nome==Tipo.Sucesso?r.exibirModal(function(){i?n():$("#tblViagem").DataTable().ajax.reload();App.ocultarModal()}):r.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()})};return{init:function(){n()}}}();jQuery(document).ready(function(){Viagem.init()});