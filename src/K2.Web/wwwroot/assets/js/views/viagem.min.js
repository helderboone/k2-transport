var Viagem=function(){var n=function(){$.get(App.corrigirPathRota("viagens-previstas"),function(n){$(".viagens-previstas").html(n);mApp.initTooltips();$("#bCadastrar").click(function(){r(null)});$("a[class*='excluir-viagem']").each(function(){var n=$(this).data("id");$(this).click(function(){App.exibirConfirm("Deseja realmente excluir essa viagem?","Sim","Não",function(){u(n,!0)})})});$("a[class*='listar-reservas']").each(function(){var n=$(this).data("id");$(this).click(function(){i(n)})})}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()})},i=function(n){App.exibirModalPorRota(App.corrigirPathRota("reservas-por-viagem/"+n),function(){App.bloquear($("#portletReserva"));$("#tblReserva").DataTable({ajax:{url:App.corrigirPathRota("listar-reservas-por-viagem/"+n),type:"POST",error:function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()}},columns:[{data:null,title:"Cliente",orderable:!1,className:"all",render:function(n){return'<span class="m--font-boldest">'+n.cliente.nome+'<\/span><br/>CPF: <span class="cpf">'+n.cliente.cpf+"<\/span><br/>RG: "+n.cliente.rg+'<br/>Celular: <span class="celular">'+n.cliente.celular+"<\/span>"}},{data:null,title:"Dependente",className:"min-tablet",orderable:!1,render:function(n,t,i){return n.dependente===null?'<a href="#" data-id="'+i.id+'" class="cadastrar-reserva-dependente m-portlet__nav-link btn m-btn m-btn--hover-brand m-btn--icon m-btn--icon-only m-btn--pill" data-container="#portletReserva" data-toggle="m-tooltip" data-placement="left" title="" data-original-title="Cadastrar dependente"><i class="la la-plus"><\/i><\/a>':'<span class="m--font-bold">'+n.dependente.nome+"<\/span><br/>Data de nascimento: "+n.dependente.dataNascimentoToString+'<br/><a href="#" data-id="'+i.id+'" class="alterar-reserva-dependente m-portlet__nav-link btn m-btn m-btn--hover-brand m-btn--icon m-btn--icon-only m-btn--pill" data-container="#portletReserva" data-toggle="m-tooltip" data-placement="right" title="" data-original-title="Alterar dependente"><i class="la la-edit"><\/i><\/a><a href="#" data-id="'+i.id+'" class="excluir-reserva-dependente m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill" data-container="#portletReserva" data-toggle="m-tooltip" data-placement="right" title="" data-original-title="Excluir dependente"><i class="la la-trash"><\/i><\/a><br/>'}},{data:null,title:"Valor pago",orderable:!1,className:"dt-right min-tablet",render:function(n){return accounting.formatMoney(n.valorPago,"R$ ",2,".",",")}},{data:"observacao",className:"min-tablet",title:"Observação",orderable:!1},{data:null,className:"td-actions dt-center min-tablet",orderable:!1,width:"70px",render:function(n,t,i){return'<a href="#" data-id="'+i.id+'" class="alterar-reserva m-portlet__nav-link btn m-btn m-btn--hover-brand m-btn--icon m-btn--icon-only m-btn--pill" data-container="#portletReserva" data-toggle="m-tooltip" data-placement="left" title="" data-original-title="Alterar reserva"><i class="la la-edit"><\/i><\/a><a href="#" data-id="'+i.id+'" class="excluir-reserva m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill" data-container="#portletReserva" data-toggle="m-tooltip" data-placement="left" title="" data-original-title="Excluir reserva"><i class="la la-trash"><\/i><\/a>'}}],select:{style:"single",info:!1},autoWidth:!1,info:!1,serverSide:!0,responsive:!0,order:[0,"asc"],searching:!1,paging:!1,lengthChange:!1,pageLength:25}).on("draw.dt",function(){mApp.initTooltips();$(".cpf").inputmask({mask:"999.999.999-99"});$(".celular").inputmask({mask:"(99) 99999-9999"});$("a[class*='cadastrar-reserva-dependente']").each(function(){var n=$(this).data("id");$(this).click(function(){t(n,!0)})});$("a[class*='alterar-reserva-dependente']").each(function(){var n=$(this).data("id");$(this).click(function(){t(n,!1)})});$("a[class*='excluir-reserva-dependente']").each(function(){var n=$(this).data("id");$(this).click(function(){App.exibirConfirm("Deseja realmente excluir o dependente dessa reserva?","Sim","Não",function(){f(n)})})})}).on("processing.dt",function(){App.desbloquear($("#portletReserva"))})},!0,"modal-reservas-por-viagem")},r=function(t){var i=t===null||t===0;App.exibirModalPorRota(i?App.corrigirPathRota("cadastrar-viagem"):App.corrigirPathRota("alterar-viagem/"+t),function(){$("#sMotorista").select2({placeholder:"Selecione um motorista",dropdownParent:$(".jc-bs3-container")});$("#sCarro").select2({placeholder:"Selecione um carro",dropdownParent:$(".jc-bs3-container")});$("#sLocalidadeEmbarque").select2({placeholder:"Selecione a localidade de embarque",dropdownParent:$(".jc-bs3-container")});$("#sLocalidadeDesembarque").select2({placeholder:"Selecione a localidade de desembarque",dropdownParent:$(".jc-bs3-container")});var t=$("#iDataHorarioSaida").data("startdate");$("#iDataHorarioSaida").datetimepicker({todayHighlight:!1,autoclose:!0,pickerPosition:"bottom-left",format:"dd/mm/yyyy hh:ii",startDate:t,language:"pt-BR"});$("#iValorPassagem").inputmask("decimal",{radixPoint:",",groupSeparator:".",autoGroup:!0,digits:2,digitsOptional:!1,placeholder:"0",rightAlign:!1,prefix:"",onBeforeMask:function(n){return n}});$("#frmManterViagem").validate({rules:{iDescricao:{required:!0},iDataHorarioSaida:{required:!0},sMotorista:{required:!0},sCarro:{required:!0},sLocalidadeEmbarque:{required:!0},sLocalidadeDesembarque:{required:!0}},submitHandler:function(){var t={Id:$("#iIdViagem").val(),IdCarro:$("#sCarro").val(),IdMotorista:$("#sMotorista").val(),IdLocalidadeEmbarque:$("#sLocalidadeEmbarque").val(),IdLocalidadeDesembarque:$("#sLocalidadeDesembarque").val(),Descricao:$("#iDescricao").val(),ValorPassagem:$("#iValorPassagem").val(),DataHorarioSaida:$("#iDataHorarioSaida").val(),LocaisEmbarque:$("#tLocaisEmbarque").val().split("\n"),LocaisDesembarque:$("#tLocaisDesembarque").val().split("\n")};App.bloquear($("#frmManterViagem"));$.post(App.corrigirPathRota(i?"cadastrar-viagem":"alterar-viagem"),{entrada:t}).done(function(t){var i=Feedback.converter(t);i.Tipo.Nome===Tipo.Sucesso?i.exibirModal(function(){n();App.ocultarModal()}):i.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()}).always(function(){App.desbloquear($("#frmManterViagem"))})}})})},t=function(n,t){App.exibirModalPorRota(t?App.corrigirPathRota("cadastrar-reserva-dependente/"+n):App.corrigirPathRota("alterar-reserva-dependente/"+n),function(){$("#iCpfDependente").inputmask({mask:"999.999.999-99"});$("#iDataNascimentoDependente").inputmask("dd/mm/yyyy",{placeholder:"_"});$("#frmManterReservaDependente").validate({rules:{iNomeDependente:{required:!0},iDataNascimentoDependente:{required:!0}},submitHandler:function(){var n={IdReserva:$("#iIdReserva").val(),Nome:$("#iNomeDependente").val(),DataNascimento:$("#iDataNascimentoDependente").val(),Cpf:$("#iCpfDependente").val(),Rg:$("#iRgDependente").val()};App.bloquear($("#frmManterReservaDependente"));$.post(App.corrigirPathRota(t?"cadastrar-reserva-dependente":"alterar-reserva-dependente"),{entrada:n}).done(function(n){var t=Feedback.converter(n);t.Tipo.Nome===Tipo.Sucesso?t.exibirModal(function(){$("#tblReserva").DataTable().ajax.reload();App.ocultarModalPorTitulo("manter-dependente")}):t.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()}).always(function(){App.desbloquear($("#frmManterReservaDependente"))})}})},!0,"manter-dependente")},u=function(t,i){App.bloquear();$.post(App.corrigirPathRota("excluir-viagem/"+t),function(t){var r=Feedback.converter(t);r.Tipo.Nome===Tipo.Sucesso?r.exibirModal(function(){i?n():$("#tblViagem").DataTable().ajax.reload();App.ocultarModal()}):r.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()})},f=function(n){App.bloquear($("#frmManterReservaDependente"));$.post(App.corrigirPathRota("excluir-reserva-dependente/"+n),function(n){var t=Feedback.converter(n);t.Tipo.Nome===Tipo.Sucesso?t.exibirModal(function(){$("#tblReserva").DataTable().ajax.reload()}):t.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()}).always(function(){App.desbloquear($("#frmManterReservaDependente"))})};return{init:function(){n()}}}();jQuery(document).ready(function(){Viagem.init()});