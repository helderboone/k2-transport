var Viagem=function(){var n=function(){$.get(App.corrigirPathRota("viagens-previstas"),function(n){$(".viagens-previstas").html(n);mApp.initTooltips();$("#bCadastrar").click(function(){u(null)});$("a[class*='excluir-viagem']").each(function(){var n=$(this).data("id");$(this).click(function(){App.exibirConfirm("Deseja realmente excluir essa viagem?","Sim","Não",function(){f(n,!0)})})});$("a[class*='listar-reservas']").each(function(){var n=$(this).data("id");$(this).click(function(){t(n)})})}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()})},t=function(n){App.exibirModalPorRota(App.corrigirPathRota("reservas-por-viagem/"+n),function(){App.bloquear($("#portletReserva"));$("#bCadastrarReserva").click(function(){var n=$(this).data("id-viagem");i(null,n)});$("#tblReserva").DataTable({ajax:{url:App.corrigirPathRota("listar-reservas-por-viagem/"+n),type:"POST",error:function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()}},columns:[{data:null,title:"Pago?",orderable:!1,className:"dt-center",width:"1px",render:function(n){switch(n.pago){case 0:return'<span class="m-badge m-badge--danger"><\/span>';case 1:return'<span class="m-badge m-badge--success"><\/span>';case 2:return'<span class="m-badge m-badge--warning"><\/span>'}}},{data:null,title:"Cliente",orderable:!1,className:"all",render:function(n){return'<span class="m--font-boldest">'+n.cliente.nome+'<\/span><br/>CPF: <span class="cpf">'+n.cliente.cpf+"<\/span><br/>RG: "+n.cliente.rg+'<br/>Celular: <span class="celular">'+n.cliente.celular+"<\/span>"}},{data:null,title:"Dependente",className:"min-tablet",orderable:!1,render:function(n){return n.dependente===null?"":'<span class="m--font-bold">'+n.dependente.nome+"<\/span><br/>Data de nascimento: "+n.dependente.dataNascimentoToString}},{data:null,title:"Valor pago",orderable:!1,className:"dt-right min-tablet",render:function(n){return accounting.formatMoney(n.valorPago,"R$ ",2,".",",")}},{data:"observacao",className:"min-tablet",title:"Observação",orderable:!1},{data:null,className:"td-actions dt-center all",orderable:!1,width:"70px",render:function(n,t,i){return'<div class="m-dropdown m-dropdown--inline m-dropdown--up m-dropdown--align-right" m-dropdown-toggle="click" aria-expanded="true"><a href="#" class="btn m-btn m-btn--hover-brand m-btn--icon m-btn--icon-only m-btn--pill m-dropdown__toggle"><i class="la la-ellipsis-h m--font-brand"><\/i><\/a><div class="m-dropdown__wrapper" style="z-index: 101;"><div class="m-dropdown__inner"><div class="m-dropdown__body"><div class="m-dropdown__content"><ul class="m-nav"><li class="m-nav__section m-nav__section--first"><span class="m-nav__section-text">Reserva<\/span><\/li><li class="m-nav__item"><a href="#" class="alterar-reserva m-nav__link" data-id="'+i.id+'"><i class="m-nav__link-icon la la-edit"><\/i><span class="m-nav__link-text">Alterar<\/span><\/a><\/li><li class="m-nav__item"><a href="#" class="excluir-reserva m-nav__link" data-id="'+i.id+'"><i class="m-nav__link-icon la la-trash"><\/i><span class="m-nav__link-text">Excluir<\/span><\/a><\/li><li class="m-nav__section"><span class="m-nav__section-text">Dependente<\/span><\/li>'+(n.dependente===null?'<li class="m-nav__item"><a href="#" class="cadastrar-dependente m-nav__link" data-id="'+i.id+'"><i class="m-nav__link-icon la la-plus"><\/i><span class="m-nav__link-text">Cadastrar<\/span><\/a><\/li>':'<li class="m-nav__item"><a href="#" class="alterar-dependente m-nav__link" data-id="'+i.id+'"><i class="m-nav__link-icon la la-edit"><\/i><span class="m-nav__link-text">Alterar<\/span><\/a><\/li><li class="m-nav__item"><a href="#" class="excluir-dependente m-nav__link" data-id="'+i.id+'"><i class="m-nav__link-icon la la-trash"><\/i><span class="m-nav__link-text">Excluir<\/span><\/a><\/li>')+"<\/ul><\/div> <\/div><\/div><\/div><\/div>"}}],select:{style:"single",info:!1},autoWidth:!1,info:!1,serverSide:!0,responsive:!0,ordering:!1,searching:!1,paging:!1,lengthChange:!1,pageLength:25}).on("draw.dt",function(){mApp.initTooltips();$(".cpf").inputmask({mask:"999.999.999-99"});$(".celular").inputmask({mask:"(99) 99999-9999"});$("a[class*='cadastrar-dependente']").each(function(){var n=$(this).data("id");$(this).click(function(){r(n,!0)})});$("a[class*='alterar-dependente']").each(function(){var n=$(this).data("id");$(this).click(function(){r(n,!1)})});$("a[class*='excluir-dependente']").each(function(){var n=$(this).data("id");$(this).click(function(){App.exibirConfirm("Deseja realmente excluir o dependente dessa reserva?","Sim","Não",function(){e(n)})})});$("a[class*='alterar-reserva']").each(function(){var n=$(this).data("id");$(this).click(function(){i(n)})})}).on("processing.dt",function(){App.desbloquear($("#portletReserva"))})},!0,"modal-reservas-por-viagem")},u=function(t){var i=t===null||t===0;App.exibirModalPorRota(i?App.corrigirPathRota("cadastrar-viagem"):App.corrigirPathRota("alterar-viagem/"+t),function(){$("#sMotorista").select2({placeholder:"Selecione um motorista",dropdownParent:$(".jc-bs3-container")});$("#sCarro").select2({placeholder:"Selecione um carro",dropdownParent:$(".jc-bs3-container")});$("#sLocalidadeEmbarque").select2({placeholder:"Selecione a localidade de embarque",dropdownParent:$(".jc-bs3-container")});$("#sLocalidadeDesembarque").select2({placeholder:"Selecione a localidade de desembarque",dropdownParent:$(".jc-bs3-container")});var t=$("#iDataHorarioSaida").data("startdate");$("#iDataHorarioSaida").datetimepicker({todayHighlight:!1,autoclose:!0,pickerPosition:"bottom-left",format:"dd/mm/yyyy hh:ii",startDate:t,language:"pt-BR"});$("#iValorPassagem").inputmask("decimal",{radixPoint:",",groupSeparator:".",autoGroup:!0,digits:2,digitsOptional:!1,placeholder:"0",rightAlign:!1,prefix:"",onBeforeMask:function(n){return n}});$("#frmManterViagem").validate({rules:{iDescricao:{required:!0},iDataHorarioSaida:{required:!0},sMotorista:{required:!0},sCarro:{required:!0},sLocalidadeEmbarque:{required:!0},sLocalidadeDesembarque:{required:!0}},submitHandler:function(){var t={Id:$("#iIdViagem").val(),IdCarro:$("#sCarro").val(),IdMotorista:$("#sMotorista").val(),IdLocalidadeEmbarque:$("#sLocalidadeEmbarque").val(),IdLocalidadeDesembarque:$("#sLocalidadeDesembarque").val(),Descricao:$("#iDescricao").val(),ValorPassagem:$("#iValorPassagem").val(),DataHorarioSaida:$("#iDataHorarioSaida").val(),LocaisEmbarque:$("#tLocaisEmbarque").val().split("\n"),LocaisDesembarque:$("#tLocaisDesembarque").val().split("\n")};App.bloquear($("#frmManterViagem"));$.post(App.corrigirPathRota(i?"cadastrar-viagem":"alterar-viagem"),{entrada:t}).done(function(t){var i=Feedback.converter(t);i.Tipo.Nome===Tipo.Sucesso?i.exibirModal(function(){n();App.ocultarModal()}):i.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()}).always(function(){App.desbloquear($("#frmManterViagem"))})}})})},i=function(i,r){var u=i===null||i===0;App.exibirModalPorRota(u?App.corrigirPathRota("cadastrar-reserva/"+r):App.corrigirPathRota("alterar-reserva/"+i),function(){K2.criarSelectClientes("#sClienteReserva",!0,"#portlet-manter-reserva");$("#bCadastrarCliente").click(function(){K2.manterCliente(null,function(){K2.criarSelectClientes("#sClienteReserva",!0,"#portlet-manter-reserva")})});mApp.initTooltips();$("#iValorPagoReserva").inputmask("decimal",{radixPoint:",",groupSeparator:".",autoGroup:!0,digits:2,digitsOptional:!1,placeholder:"0",rightAlign:!1,prefix:""});$("#frmManterReserva").validate({rules:{sClienteReserva:{required:!0}},submitHandler:function(){var i={Id:$("#iIdReserva").val(),IdViagem:$("#iIdViagem").val(),IdCliente:$("#sClienteReserva").val(),ValorPago:$("#iValorPagoReserva").val(),Observacao:$("#tObservacaoReserva").val()};App.bloquear($("#frmManterReserva"));$.post(App.corrigirPathRota(u?"cadastrar-reserva":"alterar-reserva"),{entrada:i}).done(function(i){var r=Feedback.converter(i);r.Tipo.Nome===Tipo.Sucesso?r.exibirModal(function(){App.ocultarModal(!0);n();t($("#iIdViagem").val())}):r.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()}).always(function(){App.desbloquear($("#frmManterReserva"))})}})},!0,"manter-reserva")},r=function(n,t){App.exibirModalPorRota(t?App.corrigirPathRota("cadastrar-reserva-dependente/"+n):App.corrigirPathRota("alterar-reserva-dependente/"+n),function(){$("#iCpfDependente").inputmask({mask:"999.999.999-99"});$("#iDataNascimentoDependente").inputmask("dd/mm/yyyy",{placeholder:"_"});$("#frmManterReservaDependente").validate({rules:{iNomeDependente:{required:!0},iDataNascimentoDependente:{required:!0}},submitHandler:function(){var n={IdReserva:$("#iIdReserva").val(),Nome:$("#iNomeDependente").val(),DataNascimento:$("#iDataNascimentoDependente").val(),Cpf:$("#iCpfDependente").val(),Rg:$("#iRgDependente").val()};App.bloquear($("#frmManterReservaDependente"));$.post(App.corrigirPathRota(t?"cadastrar-reserva-dependente":"alterar-reserva-dependente"),{entrada:n}).done(function(n){var t=Feedback.converter(n);t.Tipo.Nome===Tipo.Sucesso?t.exibirModal(function(){$("#tblReserva").DataTable().ajax.reload();App.ocultarModalPorTitulo("manter-dependente")}):t.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()}).always(function(){App.desbloquear($("#frmManterReservaDependente"))})}})},!0,"manter-dependente")},f=function(t,i){App.bloquear();$.post(App.corrigirPathRota("excluir-viagem/"+t),function(t){var r=Feedback.converter(t);r.Tipo.Nome===Tipo.Sucesso?r.exibirModal(function(){i?n():$("#tblViagem").DataTable().ajax.reload();App.ocultarModal()}):r.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()})},e=function(n){App.bloquear($("#frmManterReservaDependente"));$.post(App.corrigirPathRota("excluir-reserva-dependente/"+n),function(n){var t=Feedback.converter(n);t.Tipo.Nome===Tipo.Sucesso?t.exibirModal(function(){$("#tblReserva").DataTable().ajax.reload()}):t.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()}).always(function(){App.desbloquear($("#frmManterReservaDependente"))})};return{init:function(){n()}}}();jQuery(document).ready(function(){Viagem.init()});