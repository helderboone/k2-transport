var Viagem=function(){var u=function(){App.bloquear();$("#tblViagensPrevistas").DataTable({ajax:{url:App.corrigirPathRota("listar-viagens-previstas"),type:"POST",error:function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()}},columns:[{data:null,title:"Descrição",className:"all",orderable:!1,render:function(n){return'<span class="m--font-boldest">'+n.descricao+"<\/span><br/>Motorista: "+n.motorista.nome+"<br/>Carro: "+n.carro.descricao+"<br/>"}},{data:null,title:"Saída em",render:function(n){return n.dataHorarioSaidaToString+'<br/><span class="m--font-boldest m--font-brand"> '+(n.quantidadeDiasSaida===0?"Hoje":n.quantidadeDiasSaida===1?"Falta 1 dia":"Faltam "+n.quantidadeDiasSaida+" dias.")+"<\/span>"}},{data:"localidadeEmbarque.nome",title:"Embarque",orderable:!1},{data:"localidadeDesembarque.nome",title:"Desembarque",orderable:!1},{data:null,title:"Reservas",orderable:!1,className:"dt-center",width:"1px",render:function(n){return'<span class="m--font-boldest m--font-brand">'+n.reservas.length+"<\/span>"}},{data:null,title:"Lugares disponíveis",orderable:!1,className:"dt-center",width:"1px",render:function(n){return'<span class="m--font-boldest '+(n.quantidadeLugaresDisponiveis===0?" m--font-danger":" m--font-success")+'">'+n.quantidadeLugaresDisponiveis+"<\/span>"}},{data:null,className:"td-actions dt-center all",orderable:!1,width:"70px",render:function(n){return'<div class="m-dropdown m-dropdown--inline" m-dropdown-toggle="click" aria-expanded="true"><a href="#" class="btn m-btn m-btn--hover-brand m-btn--icon m-btn--icon-only m-btn--pill m-dropdown__toggle"><i class="la la-ellipsis-h m--font-brand"><\/i><\/a><div class="m-dropdown__wrapper" style="z-index: 101; top: -466%; right: 33px !important; width:165px;"><div class="m-dropdown__inner"><div class="m-dropdown__body"><div class="m-dropdown__content"><ul class="m-nav"><li class="m-nav__item"><a href="#" class="listar-reservas m-nav__link" data-id="'+n.id+'"><i class="m-nav__link-icon fa fa-handshake"><\/i><span class="m-nav__link-text">Reservas...<\/span><\/a><\/li><li class="m-nav__section"><span class="m-nav__section-text">Viagem<\/span><\/li><li class="m-nav__item"><a href="#" class="info-viagem m-nav__link" data-id="'+n.id+'"><i class="m-nav__link-icon la la-info"><\/i><span class="m-nav__link-text">Informações<\/span><\/a><\/li><li class="m-nav__item"><a href="#" class="alterar-viagem m-nav__link" data-id="'+n.id+'"><i class="m-nav__link-icon la la-edit"><\/i><span class="m-nav__link-text">Alterar<\/span><\/a><\/li><li class="m-nav__item"><a href="#" class="excluir-viagem m-nav__link" data-id="'+n.id+'"><i class="m-nav__link-icon la la-trash"><\/i><span class="m-nav__link-text">Excluir<\/span><\/a><\/li><\/ul><\/div><\/div><\/div><\/div><\/div>'}}],select:{style:"single",info:!1},serverSide:!0,responsive:!0,info:!1,ordering:!1,searching:!1,paging:!1}).on("draw.dt",function(){mApp.initTooltips();$("a[class*='listar-reservas']").each(function(){var t=$(this).data("id");$(this).click(function(){n(t)})});$("a[class*='info-viagem']").each(function(){var n=$(this).data("id");$(this).click(function(){K2.obterInfoViagem(n)})});$("a[class*='alterar-viagem']").each(function(){var n=$(this).data("id");$(this).click(function(){t(n)})});$("a[class*='excluir-viagem']").each(function(){var n=$(this).data("id");$(this).click(function(){App.exibirConfirm('<span class="m--font-boldest">Deseja realmente excluir essa viagem?<\/span><br/>Ao excluir a viagem, todas as reservas relacionadas também serão excluídas.',"Sim","Não",function(){f(n,!0)})})})}).on("processing.dt",function(){App.bloquear()})},n=function(n){App.exibirModalPorRota(App.corrigirPathRota("reservas-por-viagem/"+n),function(){App.bloquear($("#portletReserva"));$("#bCadastrarReserva").click(function(){var n=$(this).data("id-viagem");i(null,n)});$("#tblReserva").DataTable({ajax:{url:App.corrigirPathRota("listar-reservas-por-viagem/"+n),type:"POST",error:function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()}},columns:[{data:null,title:"Pago?",orderable:!1,className:"dt-center",width:"1px",render:function(n){switch(n.pago){case 0:return'<span class="m-badge m-badge--danger"><\/span>';case 1:return'<span class="m-badge m-badge--success"><\/span>';case 2:return'<span class="m-badge m-badge--warning"><\/span>'}}},{data:null,title:"Cliente",orderable:!1,className:"all",render:function(n){return'<span class="m--font-boldest">'+n.cliente.nome+'<\/span><br/>CPF: <span class="cpf">'+n.cliente.cpf+"<\/span><br/>RG: "+n.cliente.rg+'<br/>Celular: <span class="celular">'+n.cliente.celular+"<\/span>"}},{data:null,title:"Dependente",className:"min-tablet",orderable:!1,render:function(n){return n.dependente===null?"":'<span class="m--font-bold">'+n.dependente.nome+"<\/span><br/>Data de nascimento: "+n.dependente.dataNascimentoToString}},{data:null,title:"Valor pago",orderable:!1,className:"dt-right min-tablet",render:function(n){return accounting.formatMoney(n.valorPago,"R$ ",2,".",",")}},{data:"observacao",className:"min-tablet",title:"Observação",orderable:!1},{data:null,className:"td-actions dt-center all",orderable:!1,width:"70px",render:function(n,t,i){return'<div class="m-dropdown m-dropdown--inline m-dropdown--up m-dropdown--align-right" m-dropdown-toggle="click" aria-expanded="true"><a href="#" class="btn m-btn m-btn--hover-brand m-btn--icon m-btn--icon-only m-btn--pill m-dropdown__toggle"><i class="la la-ellipsis-h m--font-brand"><\/i><\/a><div class="m-dropdown__wrapper" style="z-index: 101; bottom: -180%; right: 33px !important; width: 150px;"><div class="m-dropdown__inner"><div class="m-dropdown__body"><div class="m-dropdown__content"><ul class="m-nav"><li class="m-nav__section m-nav__section--first"><span class="m-nav__section-text">Reserva<\/span><\/li><li class="m-nav__item"><a href="#" class="alterar-reserva m-nav__link" data-id="'+i.id+'"><i class="m-nav__link-icon la la-edit"><\/i><span class="m-nav__link-text">Alterar<\/span><\/a><\/li><li class="m-nav__item"><a href="#" class="excluir-reserva m-nav__link" data-id="'+i.id+'"><i class="m-nav__link-icon la la-trash"><\/i><span class="m-nav__link-text">Excluir<\/span><\/a><\/li><li class="m-nav__section"><span class="m-nav__section-text">Dependente<\/span><\/li>'+(n.dependente===null?'<li class="m-nav__item"><a href="#" class="cadastrar-dependente m-nav__link" data-id="'+i.id+'"><i class="m-nav__link-icon la la-plus"><\/i><span class="m-nav__link-text">Cadastrar<\/span><\/a><\/li>':'<li class="m-nav__item"><a href="#" class="alterar-dependente m-nav__link" data-id="'+i.id+'"><i class="m-nav__link-icon la la-edit"><\/i><span class="m-nav__link-text">Alterar<\/span><\/a><\/li><li class="m-nav__item"><a href="#" class="excluir-dependente m-nav__link" data-id="'+i.id+'"><i class="m-nav__link-icon la la-trash"><\/i><span class="m-nav__link-text">Excluir<\/span><\/a><\/li>')+"<\/ul><\/div> <\/div><\/div><\/div><\/div>"}}],select:{style:"single",info:!1},autoWidth:!1,info:!1,serverSide:!0,responsive:!0,ordering:!1,searching:!1,paging:!1,lengthChange:!1,pageLength:25}).on("draw.dt",function(){mApp.initTooltips();$(".cpf").inputmask({mask:"999.999.999-99"});$(".celular").inputmask({mask:"(99) 99999-9999"});$("a[class*='cadastrar-dependente']").each(function(){var n=$(this).data("id");$(this).click(function(){r(n,!0)})});$("a[class*='alterar-dependente']").each(function(){var n=$(this).data("id");$(this).click(function(){r(n,!1)})});$("a[class*='excluir-dependente']").each(function(){var n=$(this).data("id");$(this).click(function(){App.exibirConfirm("Deseja realmente excluir o dependente dessa reserva?","Sim","Não",function(){o(n)})})});$("a[class*='alterar-reserva']").each(function(){var n=$(this).data("id");$(this).click(function(){i(n)})});$("a[class*='excluir-reserva']").each(function(){var n=$(this).data("id");$(this).click(function(){App.exibirConfirm("Deseja realmente excluir essa reserva?","Sim","Não",function(){e(n,!0)})})})}).on("processing.dt",function(){App.desbloquear($("#portletReserva"))})},!0,"modal-reservas-por-viagem")},t=function(n){var t=n===null||n===0;App.exibirModalPorRota(t?App.corrigirPathRota("cadastrar-viagem"):App.corrigirPathRota("alterar-viagem/"+n),function(){$("#sMotorista").select2({placeholder:"Selecione um motorista"});$("#sCarro").select2({placeholder:"Selecione um carro"});$("#sLocalidadeEmbarque").select2({placeholder:"Selecione a localidade de embarque"});$("#sLocalidadeDesembarque").select2({placeholder:"Selecione a localidade de desembarque"});var n=$("#iDataHorarioSaida").data("startdate");$("#iDataHorarioSaida").datetimepicker({todayHighlight:!1,autoclose:!0,pickerPosition:"bottom-left",format:"dd/mm/yyyy hh:ii",startDate:n,language:"pt-BR"});$("#iValorPassagem").inputmask("decimal",{radixPoint:",",groupSeparator:".",autoGroup:!0,digits:2,digitsOptional:!1,placeholder:"0",rightAlign:!1,prefix:"",onBeforeMask:function(n){return n}});$("#frmManterViagem").validate({rules:{iDescricao:{required:!0},iDataHorarioSaida:{required:!0},sMotorista:{required:!0},sCarro:{required:!0},sLocalidadeEmbarque:{required:!0},sLocalidadeDesembarque:{required:!0}},submitHandler:function(){var n={Id:$("#iIdViagem").val(),IdCarro:$("#sCarro").val(),IdMotorista:$("#sMotorista").val(),IdLocalidadeEmbarque:$("#sLocalidadeEmbarque").val(),IdLocalidadeDesembarque:$("#sLocalidadeDesembarque").val(),Descricao:$("#iDescricao").val(),ValorPassagem:$("#iValorPassagem").val(),DataHorarioSaida:$("#iDataHorarioSaida").val(),LocaisEmbarque:$("#tLocaisEmbarque").val().split("\n"),LocaisDesembarque:$("#tLocaisDesembarque").val().split("\n")};App.bloquear();$.post(App.corrigirPathRota(t?"cadastrar-viagem":"alterar-viagem"),{entrada:n}).done(function(n){var t=Feedback.converter(n);t.Tipo.Nome===Tipo.Sucesso?t.exibirModal(function(){$("#tblViagensPrevistas").DataTable().ajax.reload();App.ocultarModal()}):t.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()}).always(function(){App.desbloquear()})}})})},i=function(t,i){var r=t===null||t===0;App.exibirModalPorRota(r?App.corrigirPathRota("cadastrar-reserva/"+i):App.corrigirPathRota("alterar-reserva/"+t),function(){K2.criarSelectClientes("#sClienteReserva",!0,"#portlet-manter-reserva");$("#bCadastrarCliente").click(function(){K2.manterCliente(null,function(){K2.criarSelectClientes("#sClienteReserva",!0,"#portlet-manter-reserva")})});mApp.initTooltips();$("#iValorPagoReserva").inputmask("decimal",{radixPoint:",",groupSeparator:".",autoGroup:!0,digits:2,digitsOptional:!1,placeholder:"0",rightAlign:!1,prefix:""});$("#frmManterReserva").validate({rules:{sClienteReserva:{required:!0}},submitHandler:function(){var t={Id:$("#iIdReserva").val(),IdViagem:$("#iIdViagem").val(),IdCliente:$("#sClienteReserva").val(),ValorPago:$("#iValorPagoReserva").val(),Observacao:$("#tObservacaoReserva").val()};App.bloquear();$.post(App.corrigirPathRota(r?"cadastrar-reserva":"alterar-reserva"),{entrada:t}).done(function(t){var i=Feedback.converter(t);i.Tipo.Nome===Tipo.Sucesso?i.exibirModal(function(){App.ocultarModal(!0);$("#tblViagensPrevistas").DataTable().ajax.reload();n($("#iIdViagem").val())}):i.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()}).always(function(){App.desbloquear()})}})},!0,"manter-reserva")},r=function(n,t){App.exibirModalPorRota(t?App.corrigirPathRota("cadastrar-reserva-dependente/"+n):App.corrigirPathRota("alterar-reserva-dependente/"+n),function(){$("#iCpfDependente").inputmask({mask:"999.999.999-99"});$("#iDataNascimentoDependente").inputmask("dd/mm/yyyy",{placeholder:"_"});$("#frmManterReservaDependente").validate({rules:{iNomeDependente:{required:!0},iDataNascimentoDependente:{required:!0}},submitHandler:function(){var n={IdReserva:$("#iIdReserva").val(),Nome:$("#iNomeDependente").val(),DataNascimento:$("#iDataNascimentoDependente").val(),Cpf:$("#iCpfDependente").val(),Rg:$("#iRgDependente").val()};App.bloquear();$.post(App.corrigirPathRota(t?"cadastrar-reserva-dependente":"alterar-reserva-dependente"),{entrada:n}).done(function(n){var t=Feedback.converter(n);t.Tipo.Nome===Tipo.Sucesso?t.exibirModal(function(){$("#tblReserva").DataTable().ajax.reload();App.ocultarModalPorTitulo("manter-dependente")}):t.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()}).always(function(){App.desbloquear()})}})},!0,"manter-dependente")},f=function(n,t){App.bloquear();$.post(App.corrigirPathRota("excluir-viagem/"+n),function(n){var i=Feedback.converter(n);i.Tipo.Nome===Tipo.Sucesso?i.exibirModal(function(){t?$("#tblViagensPrevistas").DataTable().ajax.reload():$("#tblViagem").DataTable().ajax.reload();App.ocultarModal()}):i.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()})},e=function(t,i){App.bloquear();$.post(App.corrigirPathRota("excluir-reserva/"+t),function(t){var r=Feedback.converter(t);r.Tipo.Nome===Tipo.Sucesso?r.exibirModal(function(){i?(App.ocultarModal(!0),$("#tblViagensPrevistas").DataTable().ajax.reload(),n($("#iIdViagem").val())):$("#tblViagem").DataTable().ajax.reload();App.ocultarModal()}):r.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()})},o=function(n){App.bloquear($("#frmManterReservaDependente"));$.post(App.corrigirPathRota("excluir-reserva-dependente/"+n),function(n){var t=Feedback.converter(n);t.Tipo.Nome===Tipo.Sucesso?t.exibirModal(function(){$("#tblReserva").DataTable().ajax.reload()}):t.exibirModal()}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibirModal()}).always(function(){App.desbloquear($("#frmManterReservaDependente"))})};return{init:function(){u();$("#bCadastrar").click(function(){t(null)})}}}();jQuery(document).ready(function(){Viagem.init()});