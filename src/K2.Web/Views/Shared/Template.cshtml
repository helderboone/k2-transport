@using Microsoft.AspNetCore.Html
@using K2.Web
@using K2.Web.Helpers
@inject CookieHelper cookieHelper
@{
    var url = this.Url.RouteUrl(this.ViewContext.RouteData.Values);
}

<!DOCTYPE html>
<html lang="en">
<!-- begin::Head -->
<head>
    <meta charset="utf-8" />
    <title>K2 | Administração</title>
    <meta name="description" content="Latest updates and statistic charts">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no">
    <!--begin::Web font -->
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
    <script>
        WebFont.load({
            google: { "families": ["Poppins:300,400,500,600,700", "Roboto:300,400,500,600,700"] },
            active: function () {
                sessionStorage.fonts = true;
            }
        });
    </script>
    <!--end::Web font -->
    <!--begin::Page Vendors Styles -->
    @RenderSection("VendorsCss", required: false)
    <!--end::Page Vendors Styles -->
    <!--begin::Base Styles -->
    <link href="~/assets/vendors/base/vendors.bundle.min.css" rel="stylesheet" type="text/css" />
    <environment include="Development">
        <link href="~/assets/style.bundle.css" rel="stylesheet" type="text/css" />
        <link href="~/assets/css/app.css" rel="stylesheet" type="text/css" />
    </environment>
    <environment exclude="Development">
        <link href="~/assets/style.bundle.min.css" rel="stylesheet" type="text/css" />
        <link href="~/assets/css/app.min.css" rel="stylesheet" type="text/css" />
    </environment>
    <!--end::Base Styles -->
    <link rel="shortcut icon" href="~/assets/img/favicon.png" />
</head>
<!-- end::Head -->
<!-- begin::Body -->
<body class="m--skin- m-content--skin-light m-header--fixed m-header--fixed-mobile m-aside--offcanvas-default">

    <!-- begin:: Page -->
    <div class="m-grid m-grid--hor m-grid--root m-page">
        <!-- BEGIN: Header -->
        <header id="m_header" class="m-grid__item    m-header " m-minimize="minimize" m-minimize-mobile="minimize" m-minimize-offset="200" m-minimize-mobile-offset="200">
            <div class="m-container m-container--fluid m-container--full-height">
                <div class="m-stack m-stack--ver m-stack--desktop  m-header__wrapper">
                    <!-- BEGIN: Brand -->
                    <div class="m-stack__item m-brand m-brand--mobile">
                        <div class="m-stack m-stack--ver m-stack--general">
                            <div class="m-stack__item m-stack__item--middle m-brand__logo">
                                <a href="index.html" class="m-brand__logo-wrapper">
                                    <img alt="" src="assets/img/logo.png" />
                                </a>
                            </div>
                            <div class="m-stack__item m-stack__item--middle m-brand__tools">
                                <!-- BEGIN: Responsive Header Menu Toggler -->
                                <a id="m_aside_header_menu_mobile_toggle" href="javascript:;" class="m-brand__icon m-brand__toggler">
                                    <span></span>
                                </a>
                                <!-- END -->
                                <!-- BEGIN: Topbar Toggler -->
                                <a id="m_aside_header_topbar_mobile_toggle" href="javascript:;" class="m-brand__icon">
                                    <i class="flaticon-more"></i>
                                </a>
                                <!-- BEGIN: Topbar Toggler -->
                            </div>
                        </div>
                    </div>
                    <!-- END: Brand -->

                    <div class="m-stack__item m-stack__item--middle m-stack__item--left m-header-head" id="m_header_nav">
                        <div class="m-stack m-stack--ver m-stack--desktop">

                            <div class="m-stack__item m-stack__item--fluid">
                                <!-- BEGIN: Horizontal Menu -->
                                <button class="m-aside-header-menu-mobile-close  m-aside-header-menu-mobile-close--skin-light" id="m_aside_header_menu_mobile_close_btn"><i class="la la-close"></i></button>
                                <div id="m_header_menu" class="m-header-menu m-aside-header-menu-mobile m-aside-header-menu-mobile--offcanvas  m-header-menu--skin-light m-header-menu--submenu-skin-light m-aside-header-menu-mobile--skin-light m-aside-header-menu-mobile--submenu-skin-light">
                                    <ul class="m-menu__nav  m-menu__nav--submenu-arrow ">

                                        @switch (cookieHelper.ObterPerfilUsuario())
                                        {
                                            case TipoPerfil.Administrador:
                                                {
                                                    <li class="m-menu__item @VerificarCssClassMenuItemAtivo("viagens")">
                                                        <a href="viagens" class="m-menu__link"><i class="m-menu__link-icon fa fa-map-marked-alt"></i><span class="m-menu__link-text">Viagens</span></a>
                                                    </li>
                                                    <li class="m-menu__item @VerificarCssClassMenuItemAtivo("clientes")">
                                                        <a href="clientes" class="m-menu__link"><i class="m-menu__link-icon fa fa-users"></i><span class="m-menu__link-text">Clientes</span></a>
                                                    </li>
                                                    <li class="m-menu__item @VerificarCssClassMenuItemAtivo("administradores", "motoristas", "proprietarios", "localidades") m-menu__item--submenu m-menu__item--rel" m-menu-submenu-toggle="click" aria-haspopup="true">
                                                        <a href="javascript:;" class="m-menu__link m-menu__toggle"><span class=" m-menu__item-here"></span><i class="m-menu__link-icon fa fa-wrench"></i><span class="m-menu__link-text">Configurações</span><i class="m-menu__hor-arrow la la-angle-down"></i><i class="m-menu__ver-arrow la la-angle-right"></i></a>
                                                        <div class="m-menu__submenu m-menu__submenu--classic m-menu__submenu--left">
                                                            <span class="m-menu__arrow m-menu__arrow--adjust"></span>
                                                            <ul class="m-menu__subnav">
                                                                <li class="m-menu__item @VerificarCssClassMenuItemAtivo("administradores", "motoristas", "proprietarios", "localidades") m-menu__item--submenu" m-menu-submenu-toggle="hover" m-menu-link-redirect="1" aria-haspopup="true">
                                                                    <a href="javascript:;" class="m-menu__link m-menu__toggle"><i class="m-menu__link-bullet m-menu__link-bullet--line"><span></span></i><span class="m-menu__link-text">Cadastros auxiliares</span><i class="m-menu__hor-arrow la la-angle-right"></i><i class="m-menu__ver-arrow la la-angle-right"></i></a>
                                                                    <div class="m-menu__submenu m-menu__submenu--classic m-menu__submenu--right">
                                                                        <span class="m-menu__arrow "></span>
                                                                        <ul class="m-menu__subnav">
                                                                            <li class="m-menu__item @VerificarCssClassMenuItemAtivo("administradores")" m-menu-link-redirect="1" aria-haspopup="true"><a href="administradores" class="m-menu__link"><i class="m-menu__link-bullet m-menu__link-bullet--line"><span></span></i><span class=" m-menu__link-text">Administradores</span></a></li>
                                                                            <li class="m-menu__item @VerificarCssClassMenuItemAtivo("motoristas")" m-menu-link-redirect="1" aria-haspopup="true"><a href="motoristas" class="m-menu__link"><i class="m-menu__link-bullet m-menu__link-bullet--line"><span></span></i><span class=" m-menu__link-text">Motoristas</span></a></li>
                                                                            <li class="m-menu__item @VerificarCssClassMenuItemAtivo("proprietarios")" m-menu-link-redirect="1" aria-haspopup="true"><a href="proprietarios" class="m-menu__link"><i class="m-menu__link-bullet m-menu__link-bullet--line"><span></span></i><span class=" m-menu__link-text">Proprietários</span></a></li>
                                                                            <li class="m-menu__item @VerificarCssClassMenuItemAtivo("carros")" m-menu-link-redirect="1" aria-haspopup="true"><a href="carros" class="m-menu__link"><i class="m-menu__link-bullet m-menu__link-bullet--line"><span></span></i><span class=" m-menu__link-text">Carros</span></a></li>
                                                                            <li class="m-menu__item @VerificarCssClassMenuItemAtivo("localidades")" m-menu-link-redirect="1" aria-haspopup="true"><a href="localidades" class="m-menu__link"><i class="m-menu__link-bullet m-menu__link-bullet--line"><span></span></i><span class=" m-menu__link-text">Localidades</span></a></li>
                                                                        </ul>
                                                                    </div>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </li>

                                                    break;
                                                }
                                            case TipoPerfil.ProprietarioCarro:
                                                {
                                                    <li class="m-menu__item @VerificarCssClassMenuItemAtivo("viagens")">
                                                        <a href="viagens" class="m-menu__link"><i class="m-menu__link-icon fa fa-map-marked-alt"></i><span class="m-menu__link-text">Viagens</span></a>
                                                    </li>
                                                    <li class="m-menu__item @VerificarCssClassMenuItemAtivo("carros")">
                                                        <a href="carros" class="m-menu__link"><i class="m-menu__link-icon fa fa-bus"></i><span class="m-menu__link-text">Meus carros</span></a>
                                                    </li>

                                                    break;
                                                }
                                            case TipoPerfil.Motorista:
                                                {
                                                    <li class="m-menu__item @VerificarCssClassMenuItemAtivo("viagens")">
                                                        <a href="viagens" class="m-menu__link"><i class="m-menu__link-icon fa fa-map-marked-alt"></i><span class="m-menu__link-text">Minhas viagens</span></a>
                                                    </li>

                                                    break;
                                                }
                                        }
                                    </ul>
                                </div>
                                <!-- END: Horizontal Menu -->
                            </div>
                        </div>
                    </div>

                    <div class="m-stack__item m-stack__item--middle m-stack__item--center">
                        <!-- BEGIN: Brand -->
                        <a href="index.html" class="m-brand m-brand--desktop">
                            <img alt="" src="assets/img/logo.png" />
                        </a>
                        <!-- END: Brand -->
                    </div>
                    <div class="m-stack__item m-stack__item--right">
                        <!-- BEGIN: Topbar -->
                        <div id="m_header_topbar" class="m-topbar  m-stack m-stack--ver m-stack--general">

                            <div class="m-stack__item m-topbar__nav-wrapper">
                                <ul class="m-topbar__nav m-nav m-nav--inline">
                                    <li class="m-nav__item m-dropdown m-dropdown--medium m-dropdown--arrow  m-dropdown--align-right m-dropdown--mobile-full-width m-dropdown--skin-light" m-dropdown-toggle="click">
                                        <a href="#" class="m-nav__link m-dropdown__toggle">
                                            <span class="m-topbar__username m--hidden-mobile">@(cookieHelper.ObterPrimeiroNomeUsuario())</span>
                                            <span class="m-topbar__userpic">
                                                <i class="fa fa-user-circle"></i>
                                            </span>
                                            <span class="m-nav__link-icon m-topbar__usericon  m--hide">
                                                <span class="m-nav__link-icon-wrapper"><i class="flaticon-user-ok"></i></span>
                                            </span>
                                        </a>
                                        <div class="m-dropdown__wrapper" style="width: 270px;">
                                            <span class="m-dropdown__arrow m-dropdown__arrow--right m-dropdown__arrow--adjust"></span>
                                            <div class="m-dropdown__inner">
                                                <div class="m-dropdown__header m--align-center" style="padding: 10px 20px;">
                                                    <div class="m-card-user m-card-user--skin-light">
                                                        <div class="m-card-user__pic">
                                                            <i class="fa fa-user-circle" style="font-size:3rem; color:#333;"></i>
                                                        </div>
                                                        <div class="m-card-user__details">
                                                            <span class="m-card-user__name m--icon-font-size-sm3" style="font-weight: 800;">@(cookieHelper.ObterNomeUsuario())</span>
                                                            <span class="m-card-user__email m--font-weight-300">@(cookieHelper.ObterNomePerfilUsuario())</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="m-dropdown__body">
                                                    <div class="m-dropdown__content">
                                                        <ul class="m-nav m-nav--skin-light">
                                                            <li class="m-nav__section m--hide">
                                                                <span class="m-nav__section-text">Section</span>
                                                            </li>
                                                            <li class="m-nav__item">
                                                                <a href="#" id="lnkAlterarMeusDados" class="m-nav__link">
                                                                    <i class="m-nav__link-icon fa fa-id-card-alt"></i>
                                                                    <span class="m-nav__link-text">Alterar meus dados</span>
                                                                </a>
                                                            </li>
                                                            <li class="m-nav__item">
                                                                <a href="javascript:;" id="lnkAlterarSenha" class="m-nav__link">
                                                                    <i class="m-nav__link-icon fa fa-lock"></i>
                                                                    <span class="m-nav__link-text">Alterar senha</span>
                                                                </a>
                                                            </li>
                                                            <li class="m-nav__separator m-nav__separator--fit">
                                                            </li>
                                                            <li class="m-nav__item m--align-right">
                                                                <a id="lnkLogout" class="btn m-btn--pill btn-secondary m-btn m-btn--custom m-btn--label-brand m-btn--bolder">Sair</a>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!-- END: Topbar -->
                    </div>
                </div>
            </div>
        </header>
        <!-- END: Header -->
        <!-- begin::Body -->
        <div class="m-grid__item m-grid__item--fluid m-grid m-grid--hor-desktop m-grid--desktop m-body">
            <div class="m-grid__item m-grid__item--fluid m-grid m-grid--ver-desktop m-grid--desktop m-container m-container--fluid m-container--full-height">
                <div class="m-grid__item m-grid__item--fluid m-wrapper">

                    <!-- BEGIN: Subheader -->
                    <div class="m-subheader ">
                        <div class="d-flex align-items-center">
                            <div class="mr-auto">
                                <h3 class="m-subheader__title m-subheader__title--separator">@ViewData["Title"]</h3>
                                <ul class="m-subheader__breadcrumbs m-nav m-nav--inline">
                                    @ObterCaminho()
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- END: Subheader -->
                    <div class="m-content">
                        <input type="hidden" id="iPerfilUsuarioLogado" value="@cookieHelper.ObterPerfilUsuario()"/>
                        @RenderBody()
                    </div>
                </div>

            </div>
        </div>
        <!-- end:: Body -->
        <!-- begin::Footer -->
        <!-- end::Footer -->

    </div>
    <!-- end:: Page -->
    <!-- begin::Scroll Top -->
    <div id="m_scroll_top" class="m-scroll-top">
        <i class="la la-arrow-up"></i>
    </div>
    <!-- end::Scroll Top -->
    <!--begin::Base Scripts -->
    <script src="~/assets/vendors/base/vendors.bundle.min.js" type="text/javascript"></script>
    <environment include="Development">
        <script src="~/assets/scripts.bundle.js" type="text/javascript"></script>
        <script src="~/assets/js/app.js" type="text/javascript"></script>
        <script src="~/assets/js/feedback.js" type="text/javascript"></script>
        <script src="~/assets/js/k2.js" type="text/javascript"></script>
    </environment>
    <environment exclude="Development">
        <script src="~/assets/scripts.bundle.min.js" type="text/javascript"></script>
        <script src="~/assets/js/app.min.js" type="text/javascript"></script>
    </environment>
    <!--end::Base Scripts -->
    <!--begin::Page Vendors Scripts -->
    @RenderSection("VendorsJs", required: false)
    <!--end::Page Vendors Scripts -->
    <!-- begin::Page Loader -->
    @RenderSection("PaginaJs", required: false)
    <script>
        $(document).ajaxStart(function () { App.bloquear(); });
        $(document).ajaxStop(function () { App.desbloquear(); });

        $(document).ready(function () {
            Offline.options = {
                checks: {
                    xhr: { url: App.corrigirPathRota('hello') }
                },
                reconnect: {
                    initialDelay: 10 // em segundos
                }
            };

            Offline.on("confirmed-down", function () {
                mApp.blockPage();
            });

            Offline.on("confirmed-up", function () {
                mApp.unblockPage();
            });

            $("#lnkAlterarMeusDados").click(function () {
                K2.alterarMeusDados();
            });

            $("#lnkAlterarSenha").click(function () {
                K2.alterarSenhaUsuario();
            });

            $("#lnkLogout").click(function () {
                App.exibirConfirm("Deseja realmente sair?", "Sim", "Não", function () {
                    $.post(App.corrigirPathRota("logout"), function () {
                        location.href = "login";
                    });
                });
            });
        });
    </script>
    <!-- end::Page Loader -->
</body>
<!-- end::Body -->
</html>

@functions {
public string VerificarCssClassMenuItemAtivo(params string[] palavrasChaves)
{
    var url = this.Url.RouteUrl(this.ViewContext.RouteData.Values);

    foreach (var palavra in palavrasChaves)
    {
        if (url.Contains(palavra))
            return "m-menu__item--active";
    }

    return string.Empty;
}

public IHtmlContent ObterCaminho()
{
    var url = this.Url.RouteUrl(this.ViewContext.RouteData.Values);

    if (url.Contains("administradores"))
    {
        return Html.Raw(
                "<li class=\"m-nav__separator\"><span class=\"m-nav__link-text\">Configurações</span></li>" +
                "<li class=\"m-nav__separator\">-</li>" +
                "<li class=\"m-nav__separator\"><span class=\"m-nav__link-text\">Cadastros</span></li>" +
                "<li class=\"m-nav__separator\">-</li>" +
                "<li class=\"m-nav__item\"><a href=\"administradores\" class=\"m-nav__link\"><span class=\"m-nav__link-text\">Administradores</span></a></li>");
    }
    else if (url.Contains("motoristas"))
    {
        return Html.Raw(
                "<li class=\"m-nav__separator\"><span class=\"m-nav__link-text\">Configurações</span></li>" +
                "<li class=\"m-nav__separator\">-</li>" +
                "<li class=\"m-nav__separator\"><span class=\"m-nav__link-text\">Cadastros</span></li>" +
                "<li class=\"m-nav__separator\">-</li>" +
                "<li class=\"m-nav__item\"><a href=\"motoristas\" class=\"m-nav__link\"><span class=\"m-nav__link-text\">Motoristas</span></a></li>");
    }
    else if (url.Contains("proprietarios"))
    {
        return Html.Raw(
                "<li class=\"m-nav__separator\"><span class=\"m-nav__link-text\">Configurações</span></li>" +
                "<li class=\"m-nav__separator\">-</li>" +
                "<li class=\"m-nav__separator\"><span class=\"m-nav__link-text\">Cadastros</span></li>" +
                "<li class=\"m-nav__separator\">-</li>" +
                "<li class=\"m-nav__item\"><a href=\"proprietarios\" class=\"m-nav__link\"><span class=\"m-nav__link-text\">Proprietários</span></a></li>");
    }
    else if (url.Contains("carros"))
    {
        return Html.Raw(cookieHelper.ObterPerfilUsuario() == TipoPerfil.Administrador ? 
                "<li class=\"m-nav__separator\"><span class=\"m-nav__link-text\">Configurações</span></li>" +
                "<li class=\"m-nav__separator\">-</li>" +
                "<li class=\"m-nav__separator\"><span class=\"m-nav__link-text\">Cadastros</span></li>" +
                "<li class=\"m-nav__separator\">-</li>" +
                "<li class=\"m-nav__item\"><a href=\"carros\" class=\"m-nav__link\"><span class=\"m-nav__link-text\">Carros</span></a></li>" : string.Empty);
    }
    else if (url.Contains("localidades"))
    {
        return Html.Raw(
                "<li class=\"m-nav__separator\"><span class=\"m-nav__link-text\">Configurações</span></li>" +
                "<li class=\"m-nav__separator\">-</li>" +
                "<li class=\"m-nav__separator\"><span class=\"m-nav__link-text\">Cadastros</span></li>" +
                "<li class=\"m-nav__separator\">-</li>" +
                "<li class=\"m-nav__item\"><a href=\"localidades\" class=\"m-nav__link\"><span class=\"m-nav__link-text\">Localidades</span></a></li>");
    }

    return Html.Raw(string.Empty);
}
}